# æ‰¹é‡è½¬è¯‘å‹ç¼©JSä»£ç 

å·¥ä½œä¸­é‡åˆ°ä¸€ä¸ªéœ€æ±‚,éœ€è¦å°†å¤§é‡ JS æ–‡ä»¶ä¸­çš„ä»£ç è¿›è¡Œ ES6+ => ES5 çš„è½¬è¯‘,åŒæ—¶å¯¹ä»£ç è¿›è¡Œå‹ç¼©å¤„ç†,æœ€ååœ¨å•ç‹¬è¾“å‡º.

ä¸€å¼€å§‹é™·å…¥ä¸€ä¸ªæ€ç»´è¯¯åŒº,ä¸ç®¡å¹²ä»€ä¹ˆæ“ä½œéƒ½æƒ³ç€åœ¨webpackä¸­æ‰§è¡Œ,å®Œå…¨å¿½è§†äº† node è¿™ä¸€ç¯å¢ƒçš„å­˜åœ¨,ç¢°å£ä¹‹å,å‘ç°äº†babel-cli è¿™ä¸€å·¥å…·,å¼€å§‹èµ°ä¸Šæ­£ç¡®çš„è§£å†³æ–¹æ³•.

## 1.  ä½¿ç”¨æ–¹æ³•

[ä»“åº“åœ°å€]: https://github.com/3biubiu/compressionCode	"ä»“åº“åœ°å€"

git clone => npm install => npm run build => å®Œäº‹

å°†å¾…å¤„ç†çš„jsæ–‡ä»¶å’Œcssæ–‡ä»¶æ”¾å…¥å¯¹åº”çš„æ–‡ä»¶å¤¹å³å¯,å‘½ä»¤æ‰§è¡Œå®Œæˆåå°†ä¼šåœ¨åŒçº§ç›®å½•ä¸‹ç”Ÿæˆ `lib/js` å’Œ `lib/css` æ–‡ä»¶å¤¹,æ–‡ä»¶åä¿æŒä¸å˜

## 2.  ä¸€äº›æ€è·¯

   **é¦–å…ˆ**åœ¨ä¸€å¼€å§‹å°±æƒ³åˆ°äº†ä½¿ç”¨ `babel` æ¥å®Œæˆè½¬ä¹‰çš„å·¥ä½œ,åœ¨æ­¤ä¹‹å‰æˆ‘ä¸€ç›´ä»¥ä¸ºbabelå…·æœ‰ä»£ç å‹ç¼©çš„åŠŸèƒ½,å®é™…æŸ¥è¯¢ä¸‹æ¥å‘ç°éä¹Ÿ,å‹ç¼©åŠŸèƒ½æ˜¯ç”± `uglify-js` æä¾›,ä¸è¿‡è¯¥å·¥å…·æ”¯æŒ `ES5` åŠä»¥ä¸‹ä»£ç ,æ‰€ä»¥åŸºæœ¬å°±å’Œ `babel` ç»‘å®šä½¿ç”¨äº†,æ­¤å‰ä¸€ç›´ç”¨ç°æˆçš„æ¡†æ¶,ä»æ¥æ²¡æœ‰è€ƒè™‘è¿‡è¿™äº›ç»†èŠ‚,å°†è¿™äº›ä¸œè¥¿ä¾æ¬¡å®‰è£…å¥½å,åˆå‘ç°äº†ä¸€ä¸ªé—®é¢˜, `uglify-js` ä¸æ”¯æŒæ‰¹é‡æ“ä½œğŸ˜’, åæ¥æœç´¢èµ„æ–™æ‰¾åˆ°æ¯”è¾ƒåˆé€‚çš„JSè„šæœ¬ç”¨æ¥è·‘æ‰¹é‡å¤„ç†çš„æ“ä½œ,ç¨åŠ æ”¹é€  å°±èƒ½ä½¿ç”¨äº†,ä»£ç å¦‚ä¸‹:

   ```js
   'use strict';
   
   const fs = require('fs');
   const path = require('path');
   const UglifyJS = require('uglify-js')
   
   const ROOT_PATH = path.join(__dirname, '../lib/js');
   function readFileList(currentPath) {
       const files = fs.readdirSync(currentPath);
   
       files.forEach(file => {
           const childPath = path.join(currentPath, file);
           const stat = fs.statSync(childPath);
           if (stat.isDirectory()) {
               readFileList(childPath);
           } else {
               if (file.endsWith('.js')) {
                   fs.writeFileSync(childPath, UglifyJS.minify({
                       "file.js": fs.readFileSync(childPath, "utf8"),
                   }).code, "utf8", function (error) {
                       console.log(error)
                   });
               }
   
           }
       })
   }
   
   readFileList(ROOT_PATH);
   ```

   **ä¹‹å** æ—¢ç„¶jséƒ½å·²ç»å‹ç¼©äº†,å°±æƒ³ç€è¦ä¸æŠŠcss ä¹Ÿè¯•ç€å‹ç¼©ä»¥ä¸‹,ç»è¿‡æŸ¥è¯¢ äº†è§£åˆ° `cssnano `æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„å‹ç¼©å·¥å…·,ä½†æ˜¯å®ƒè¿è¡Œæ—¶éœ€è¦postcssä½œä¸ºè¿è¡Œç¯å¢ƒ,å¾ˆå¤š `css` ç›¸å…³çš„å·¥å…·éƒ½éœ€è¦ `postcss` ä½œä¸ºä¸€ä¸ªå¹³å°,åŒæ—¶ æˆ‘ä»¬éœ€è¦åŒæ—¶ `postcss-cli` å»æ‰§è¡Œä¸€äº›å‘½ä»¤,å¥½åœ¨ `postcss-cli` æ”¯æŒ æ‰¹é‡æ“ä½œ,ä¸éœ€è¦å¤§è´¹å‘¨æŠ˜.

   **OK**, `css `å’Œ `js` å·²ç»å‹ç¼©å¦¥å½“,ä½†æ˜¯æˆ‘çœ‹ç€è‡ªå·±å†™äº†ä¸‰å››æ¡å‘½ä»¤é™·å…¥æ²‰æ€,æ€»ä¸èƒ½è·‘ä¸€æ¬¡å°±æ˜¯ä¾æ¬¡è¿è¡Œå››ä¸ªå‘½ä»¤å§,å®Œå…¨æ²¡æœ‰è‡ªåŠ¨åŒ–çš„ç¾æ„Ÿä¸çˆ½å¿«,äºæ˜¯ä¹ç»§ç»­ä¸€ç•ªæŸ¥æ‰¾,è¢«æˆ‘æ‰¾åˆ°äº†è§£å†³åŠæ³•: 

   `node` ä¸­æœ‰ `&&` å’Œ `&` ä¸¤ç§è¿æ¥ç¬¦å·,å…¶ä¸­,åœ¨ `bash` å‘½ä»¤æˆ– `npm script` ä¸­ä½¿ç”¨ `&` æ¥å®ç°`å¹¶å‘`æ•ˆæœæ—¶ï¼Œå®é™…ä¸Šæ˜¯æŠŠ`&`å·¦ä¾§çš„å‘½ä»¤ä¸¢å…¥åå°è¿è¡Œï¼Œå³ä¾§å‰©ä½™å‘½ä»¤çœ‹åš *æ•´ä½“* ä»»åŠ¡åœ¨å‰å°è¿è¡Œï¼Œä»¥æ­¤æ¥å®ç°å¹¶å‘æ•ˆæœã€‚è€Œ `&&` æ˜¯ä¸²è¡Œæ‰§è¡Œä¸¤ä¾§å‘½ä»¤ï¼Œå…ˆæ‰§è¡Œå®Œå·¦ä¾§åå†æ‰§è¡Œå³ä¾§ã€‚

   *åˆ‡è®°ï¼ï¼ï¼*

   ```shell
   command1 & command2 && command3
   ```

   å¹¶ä¸æ˜¯å¹¶å‘æ‰§è¡Œ`command1`å’Œ`command2`åå†æ‰§è¡Œ`command3`

   è€Œæ˜¯å¹¶å‘æ‰§è¡Œ`command1`å’Œ`command2 && command3`

   ç»è¿‡è¿™ä¹ˆç»„åˆ,æˆ‘çš„æœ€ç»ˆ `npm script` å¦‚ä¸‹:

   ```json
   "build": "postcss css --dir lib/css & babel js -d lib/js --presets=@babel/env && node scripts/minifyJs.js",
   ```

   (å®Œ)

   å¦‚æœé”™è¯¯,æ¬¢è¿æŒ‡æ­£.

   -- BIUBIU

